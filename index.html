<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ビンゴカード生成｜無料で遊べるオンラインビンゴ</title>
  <meta name="description" content="無料で使えるオンラインビンゴカード生成ツール。カラフルなカードを自動生成し、リーチやビンゴを自動判定。家族や友達とスマホ・PCで楽しめます。">
  <meta name="keywords" content="ビンゴ,オンライン,無料,カード生成,リーチ,ビンゴ判定,ゲーム,イベント,パーティー">

  <!-- OGP設定 -->
  <meta property="og:title" content="ビンゴカード生成｜無料で遊べるオンラインビンゴ" />
  <meta property="og:description" content="カラフルなビンゴカードを自動生成。リーチやビンゴを自動判定でき、イベントやパーティーで大活躍。" />
  <meta property="og:image" content="https://kkpwebninja.com/card-bingo.png" />
  <meta property="og:url" content="https://kkpwebninja.com/bingo-card" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2LM85GJN0L');
  </script>

  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; padding: 2rem; background: #e3f2fd; }
    h1 { font-size: 2.2rem; margin-bottom: 1rem; color: #0d47a1; }
    #bingo { display: grid; grid-template-columns: repeat(5, 60px); grid-gap: 10px; justify-content: center; margin: 1rem auto; }
    .cell { width: 60px; height: 60px; border-radius: 50%; font-size: 1.1rem; font-weight: bold; line-height: 60px; color: white; user-select: none; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .cell.B { background-color: #2196F3; }
    .cell.I { background-color: #F44336; }
    .cell.N { background-color: #4CAF50; }
    .cell.G { background-color: #FFEB3B; color: black; }
    .cell.O { background-color: #FF9800; }
    .marked { opacity: 0.3; text-decoration: line-through; }
    .bingo-line { outline: 3px solid gold; }
    #startTime { font-size: 1.1rem; margin-top: 0.5rem; color: #333; }
    button { font-size: 1rem; margin: 0.5rem; padding: 0.7rem 1.4rem; border: none; border-radius: 8px; box-shadow: 0 3px 5px rgba(0,0,0,0.2); cursor: pointer; transition: 0.3s; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-generate { background: #0288d1; color: white; }
    .btn-start { background: #43a047; color: white; }
    #controls { margin-top: 1.5rem; }
    #statusMsg { margin-top: 1rem; font-size: 1.5rem; color: #d32f2f; min-height: 2rem; }
    #footer { margin-top: 2rem; font-size: 0.9rem; color: #555; }
    #footer a { color: #0288d1; text-decoration: none; }
  </style>
</head>
<body>
  <h1>ビンゴカード生成</h1>
  <button class="btn-generate" onclick="confirmGenerate()">生成</button>
  <div id="bingo"></div>
  <div id="controls">
    <button id="startBtn" class="btn-start" onclick="confirmStart()" disabled>スタート</button>
    <div id="startTime"></div>
    <div id="statusMsg"></div>
  </div>
  <div id="footer">
    X <a href="https://x.com/kkp_webninja" target="_blank">@kkp_webninja</a><br>
    🏯 <a href="https://kkpwebninja.com" target="_blank">web忍者の本丸</a><br>
    各巻物（アプリ）の入り口は本丸ページに集めているでござる。
  </div>

  <script>
    const bingo = document.getElementById('bingo');
    const startBtn = document.getElementById('startBtn');
    const statusMsg = document.getElementById('statusMsg');
    const startTimeDisplay = document.getElementById('startTime');
    let allowClick = false;
    const limitMinutes = 10;

    function confirmGenerate() {
      if (localStorage.getItem('bingoStartTime')) {
        if (!confirm('プレイ中です。カードを再生成しますか？')) return;
        localStorage.removeItem('bingoStartTime');
      }
      generateCard();
    }

    function confirmStart() {
      if (localStorage.getItem('bingoStartTime')) {
        if (!confirm('すでにプレイ中です。リセットして再スタートしますか？')) return;
      }
      startTimer();
    }

    function generateNumbers(start, end, count) {
      const numbers = [];
      for (let i = start; i <= end; i++) numbers.push(i);
      const result = [];
      while (result.length < count) {
        const i = Math.floor(Math.random() * numbers.length);
        result.push(numbers.splice(i, 1)[0]);
      }
      return result;
    }

    function generateCard() {
      bingo.innerHTML = '';
      const card = [];
      const columns = [
        generateNumbers(1, 15, 5),
        generateNumbers(16, 30, 5),
        generateNumbers(31, 45, 5),
        generateNumbers(46, 60, 5),
        generateNumbers(61, 75, 5),
      ];
      for (let row = 0; row < 5; row++) {
        for (let col = 0; col < 5; col++) {
          const value = (row === 2 && col === 2) ? 'FREE' : columns[col][row];
          const cell = document.createElement('div');
          const colClasses = ['B','I','N','G','O'];
          cell.className = 'cell ' + colClasses[col];
          cell.textContent = value;
          if (value === 'FREE') {
            cell.classList.add('marked');
          } else {
            cell.addEventListener('click', () => {
              if (!allowClick) return;
              cell.classList.toggle('marked');
              saveState();
              checkBingo();
            });
          }
          bingo.appendChild(cell);
          card.push({ value, marked: value === 'FREE' });
        }
      }
      saveState(card);
      startBtn.disabled = false;
      statusMsg.textContent = '';
    }

    function startTimer() {
      allowClick = true;
      const now = new Date();
      localStorage.setItem('bingoStartTime', now.getTime());
      startTimeDisplay.textContent = `スタート時刻: ${formatTime(now)}`;
      statusMsg.textContent = '';
    }

    function restoreTimer() {
      const startTimestamp = localStorage.getItem('bingoStartTime');
      if (startTimestamp) {
        const startDate = new Date(parseInt(startTimestamp));
        const elapsed = (Date.now() - startDate.getTime()) / 1000;
        if (elapsed >= limitMinutes * 60) {
          allowClick = false;
          localStorage.removeItem('bingoStartTime');
          alert('時間切れです');
        } else {
          allowClick = true;
          startTimeDisplay.textContent = `スタート時刻: ${formatTime(startDate)}`;
        }
      }
    }

    function formatTime(date) {
      return `${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}:${date.getSeconds().toString().padStart(2,'0')}`;
    }

    function checkBingo() {
      const grid = [...document.querySelectorAll('.cell')];
      const lines = [
        [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
        [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
        [0,6,12,18,24], [4,8,12,16,20]
      ];
      let bingoCount = 0;
      let reachCount = 0;
      lines.forEach(line => {
        const marked = line.filter(i => grid[i].classList.contains('marked'));
        line.forEach(i => grid[i].classList.remove('bingo-line'));
        if (marked.length === 5) {
          line.forEach(i => grid[i].classList.add('bingo-line'));
          bingoCount++;
        } else if (marked.length === 4) {
          reachCount++;
        }
      });
      if (bingoCount > 0) {
        statusMsg.textContent = `🎉 BINGO! ${bingoCount}本!`;
      } else if (reachCount > 0) {
        statusMsg.textContent = `🎯 リーチ！ ${reachCount}箇所`;
      } else {
        statusMsg.textContent = '';
      }
    }

    function saveState(card = null) {
      if (!card) {
        const current = Array.from(document.querySelectorAll('.cell')).map(cell => ({ value: cell.textContent, marked: cell.classList.contains('marked') }));
        localStorage.setItem('bingoCard', JSON.stringify(current));
      } else {
        localStorage.setItem('bingoCard', JSON.stringify(card));
      }
    }

    function loadState() {
      const saved = localStorage.getItem('bingoCard');
      if (!saved) return;
      const card = JSON.parse(saved);
      if (card.length !== 25) return;
      bingo.innerHTML = '';
      card.forEach(({ value, marked }, index) => {
        const colClasses = ['B','I','N','G','O'];
        const col = index % 5;
        const cell = document.createElement('div');
        cell.className = 'cell ' + colClasses[col];
        cell.textContent = value;
        if (marked) cell.classList.add('marked');
        if (value !== 'FREE') {
          cell.addEventListener('click', () => {
            if (!allowClick) return;
            cell.classList.toggle('marked');
            saveState();
            checkBingo();
          });
        }
        bingo.appendChild(cell);
      });
      startBtn.disabled = false;
    }

    window.onload = () => {
      loadState();
      restoreTimer();
    };
  </script>
</body>
</html>
